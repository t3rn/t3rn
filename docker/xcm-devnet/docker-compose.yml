version: "3.9"

networks:
  devnet:
    name: devnet
    driver: bridge

services:
  alice:
    image: polkadot:release-v0.9.13
    build:
      context: .
      dockerfile: polkadot.Dockerfile
    networks:
      - devnet
    ports:
      - "10001:10001"
      - "8844:8844"
      - "9944:9944"
    volumes:
      - type: bind
        source: ./specs/rococo-local.raw.json
        target: /pdot/rococo-local.raw.json
        read_only: true
      - type: bind
        source: ./data/alice
        target: /pdot/data
        read_only: false
    container_name: alice
    command: >
      --port 10001
      --rpc-port 8844
      --ws-port 9944
      --alice
      -d /pdot/data
      --validator
      --rpc-cors all
      --unsafe-ws-external
      --unsafe-rpc-external
      --chain /pdot/rococo-local.raw.json

  bob:
    image: polkadot:release-v0.9.13
    build:
      context: .
      dockerfile: polkadot.Dockerfile
    networks:
      - devnet
    ports:
      - "10002:10002"
      - "8845:8845"
      - "9945:9945"
    volumes:
      - type: bind
        source: ./specs/rococo-local.raw.json
        target: /pdot/rococo-local.raw.json
        read_only: true
      - type: bind
        source: ./data/bob
        target: /pdot/data
        read_only: false
    container_name: bob
    depends_on:
      - alice
    command: >
      --port 10002
      --rpc-port 8845
      --ws-port 9945
      --bob
      -d /pdot/data
      --validator
      --rpc-cors all
      --unsafe-ws-external
      --unsafe-rpc-external
      --chain /pdot/rococo-local.raw.json

  charlie:
    image: polkadot:release-v0.9.13
    build:
      context: .
      dockerfile: polkadot.Dockerfile
    networks:
      - devnet
    ports:
      - "10003:10003"
      - "8846:8846"
      - "9946:9946"
    volumes:
      - type: bind
        source: ./specs/rococo-local.raw.json
        target: /pdot/rococo-local.raw.json
        read_only: true
      - type: bind
        source: ./data/charlie
        target: /pdot/data
        read_only: false
    container_name: charlie
    depends_on:
      - alice
      - bob
    command: >
      --port 10003
      --rpc-port 8846
      --ws-port 9946
      --charlie
      -d /pdot/data
      --validator
      --rpc-cors all
      --unsafe-ws-external
      --unsafe-rpc-external
      --chain /pdot/rococo-local.raw.json

  t3rn:
    image: circuit-collator:latest
    build:
      context: ../..
      dockerfile: docker/xcm-devnet/t3rn.Dockerfile
    networks:
      - devnet
    ports:
      - "33333:33333"
      - "8833:8833"
      - "9933:9933"
      - "33332:33332"
      - "8832:8832"
      - "9932:9932"
    volumes:
      - type: bind
        source: ./specs/rococo-local.raw.json
        target: /t3rn/rococo-local.raw.json
        read_only: true
      - type: bind
        source: ./specs/t3rn.raw.json
        target: /t3rn/t3rn.raw.json
        read_only: true
      - type: bind
        source: ./data/t3rn
        target: /t3rn/data
        read_only: false
    container_name: t3rn
    depends_on:
      - alice
      - bob
      - charlie
    command: >
      --port 33333
      --rpc-port 8833
      --ws-port 9933
      -d /t3rn/data
      --collator
      --rpc-cors all
      --unsafe-ws-external
      --unsafe-rpc-external
      --execution=native
      -lruntime=debug
      --chain /t3rn/t3rn.raw.json
      --
      --chain /t3rn/rococo-local.raw.json
      --discover-local
      --port 33332
      --rpc-port 8832
      --ws-port 9932
      --execution=wasm

  pchain:
    image: parachain-collator:polkadot-v0.9.13
    build:
      context: .
      dockerfile: pchain.Dockerfile
    networks:
      - devnet
    ports:
      - "44444:44444"
      - "4488:4488"
      - "4499:4499"
      - "44443:44443"
      - "4487:4487"
      - "4498:4498"
    volumes:
      - type: bind
        source: ./specs/rococo-local.raw.json
        target: /para/rococo-local.raw.json
        read_only: true
      - type: bind
        source: ./specs/pchain.raw.json
        target: /para/pchain.raw.json
        read_only: true
      - type: bind
        source: ./data/pchain
        target: /para/data
        read_only: false
    container_name: pchain
    depends_on:
      - alice
      - bob
      - charlie
    command: >
      --port 44444
      --rpc-port 4488
      --ws-port 4499
      -d /para/data
      --collator
      --rpc-cors all
      --unsafe-ws-external
      --unsafe-rpc-external
      --execution=native
      -lruntime=debug
      --chain /para/pchain.raw.json
      --
      --chain /para/rococo-local.raw.json
      --discover-local
      --port 44443
      --rpc-port 4487
      --ws-port 4498
      --execution=wasm
